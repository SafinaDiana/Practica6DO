# Practica6DO
## Ход работы
### Шаг 1 Подготовка окружения
Проверка корректной установки инструментов 

<img width="692" height="93" alt="image" src="https://github.com/user-attachments/assets/a043927c-4adb-4191-b1eb-7b4e3acf604f" />

### Шаг 2 Генерация ключей Age 
Для шифрования данных был сгенерирован ключ Age с помощью команды:

```
age-keygen -o keys.txt
```

<img width="920" height="48" alt="image" src="https://github.com/user-attachments/assets/fbc85397-ea19-4dfb-9ce0-ae78cb7fd5ed" />

В результате был создан файл keys.txt, содержащий приватный ключ, а также выведен публичный ключ, который используется для шифрования данных.


### Шаг 3 Настройка конфигурации SOPS 
В корне проекта был создан файл конфигурации .sops.yaml, содержащий правила шифрования:

```
creation_rules:
  - path_regex: 'secrets\\.*\.yaml$'
    age: 'age1...'
```

Правило указывает, что все YAML-файлы в каталоге secrets должны автоматически шифроваться с использованием указанного публичного ключа Age. Регулярное выражение адаптировано под файловую систему Windows.

### Шаг 4 Шифрование конфиденциальных данных

Был создан файл secrets/database.yaml, содержащий чувствительные данные (логин и пароль).

```
database:
  user: postgres
  password: SuperSecretPassword123!
```

Шифрование выполнялось командой:

```
sops --encrypt secrets\database.yaml > secrets\database.enc.yaml
```

<img width="1895" height="599" alt="image" src="https://github.com/user-attachments/assets/59d2a2be-a35e-4d97-8db7-b056bd91e52b" />

В результате был получен зашифрованный файл database.enc.yaml, содержащий зашифрованные значения и служебный блок sops.

###  Шаг 5 Расшифровка данных
Для расшифровки зашифрованного файла была предварительно задана переменная окружения, указывающая путь к приватному ключу Age:

```
export SOPS_AGE_KEY_FILE="$PWD/keys.txt"
```

После этого расшифровка данных выполнялась командой:

```
sops --decrypt secrets/db.enc.yaml
```

В результате выполнения команды были успешно получены исходные данные (логин и пароль для подключения к базе данных), что подтверждает корректную работу механизма расшифровки

<img width="1078" height="165" alt="image" src="https://github.com/user-attachments/assets/cda3ca09-fd64-4f2a-92d5-a77ce14fb3fb" />

### Шаг 6 Редактирование зашифрованных файлов

Для демонстрации возможности редактирования зашифрованного файла была использована команда sops с указанием редактора через переменную окружения:

```
export EDITOR=nano
sops secrets/db.enc.yaml
```

Файл открылся в расшифрованном виде.

Внесено изменение пароля базы данных для тестирования:


<img width="482" height="136" alt="image" src="https://github.com/user-attachments/assets/b1e9c331-ffe6-4eab-b2a6-53b32a30fa98" />

После выхода из редактора SOPS автоматически перешифровал файл.

Проверка расшифровки файла показала новые значения:

```
sops --decrypt secrets/db.enc.yaml
```

<img width="1018" height="93" alt="image" src="https://github.com/user-attachments/assets/322dc9cb-d870-4df3-9b5b-8bfaf05c8ff6" />


### Вывод
В ходе выполнения практической работы были изучены и успешно применены инструменты SOPS и Age для безопасного хранения конфиденциальных данных. Использование Ubuntu в WSL позволило развернуть полноценное Linux-окружение на Windows. Было продемонстрировано, что SOPS обеспечивает надёжное шифрование, удобное редактирование и безопасную работу с секретами, что делает данный инструмент полезным в DevOps-практиках. Структура репозитория GitHub Репозиторий имеет следующую структуру: age-sops/ .sops.yaml secrets.yaml secrets.enc.yaml README.md Файл age.key в репозиторий не добавляется, так как содержит приватный ключ.
